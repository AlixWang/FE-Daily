# æ·±å…¥react-fiber-(reactæ–°è°ƒåº¦ç®—æ³•çš„æ·±å…¥ç†è§£) #

![head-picture](http://ww1.sinaimg.cn/large/006tNc79gy1g5o1la5tiej30j708caa5.jpg)

æˆ‘ä»¬éƒ½çŸ¥é“Reactæ˜¯åŸºäºè¿½è¸ªç»„ä»¶çŠ¶æ€æ›´æ–°å¹¶åŒæ­¥è‡³å±å¹•ä¸Šç”¨æ¥æ„å»ºç”¨æˆ·ç•Œé¢çš„å‰ç«¯åº“ã€‚åœ¨reactä¸­æˆ‘ä»¬çŸ¥é“è¿™æ˜¯åŸºäºä¸€ä¸ªåå«reconciliationï¼ˆè°ƒè§£ï¼‰çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬è°ƒç”¨`setState`æ–¹æ³•è€Œæ¡†æ¶å†…éƒ¨åˆ™æ¯”è¾ƒstateå’Œpropsçš„å˜åŒ–å»é‡ç»˜ç»„ä»¶æ›´æ–°UIç•Œé¢ã€‚

Reactçš„å®˜æ–¹æ–‡æ¡£å¯¹æ­¤æä¾›äº†ä¸€ä¸ªå¾ˆå¥½åœ°é«˜çº§æ¦‚è¿°ï¼šReactå…ƒç´ ã€ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€`render`å‡½æ•°çš„è§„åˆ™ä»¥åŠè¿ç”¨äºå­ç»„ä»¶çš„diffç®—æ³•ã€‚ä»renderæ–¹æ³•è¿”å›çš„ä¸å¯å˜Reactå…ƒç´ æ ‘é€šå¸¸ç§°ä¸ºâ€œè™šæ‹ŸDOMâ€ã€‚è¿™ä¸ªæœ¯è¯­å¾ˆæ—©å°±å¸®åŠ©äººä»¬è§£é‡Šäº†Reactï¼Œä½†æ˜¯åŒæ ·å¼•å…¥äº†ä»¤äººè¿·æƒ‘çš„äº‹æƒ…ï¼Œè€Œä¸”å¹¶æ²¡æœ‰åœ¨reactçš„å®˜æ–¹æ–‡æ¡£ä¸­æœ‰ä»»ä½•æåŠã€‚åœ¨æœ¬æ–‡ä¸­æˆ‘å°†åšç§°å…¶ä¸ºreactå…ƒç´ æ ‘ã€‚
é™¤äº†Reactå…ƒç´ æ ‘ï¼Œæ¡†æ¶å†…éƒ¨ä¹Ÿæ€»æ˜¯æœ‰å†…éƒ¨ç¤ºä¾‹æ ‘ï¼ˆæ¯”å¦‚ç»„ä»¶ã€DOMèŠ‚ç‚¹ç­‰ï¼‰ç”¨æ¥ä¿æŒå†…éƒ¨çŠ¶æ€ã€‚ä»ç‰ˆæœ¬16å¼€å§‹ï¼ŒReactæ¨å‡ºäº†è¯¥å†…éƒ¨å®ä¾‹æ ‘çš„æ–°å®ç°ä»¥åŠç®¡ç†ä»£å·ä¸ºFiberçš„ç®—æ³•ã€‚ä¸ºäº†äº†è§£Fiberæ¶æ„å¸¦æ¥çš„ä¼˜åŠ¿ï¼Œ[äº†è§£Reactåœ¨Fiberä¸­ä½¿ç”¨é“¾è¡¨çš„æ–¹å¼å’ŒåŸå› ](https://medium.com/dailyjs/the-how-and-why-on-reacts-usage-of-linked-list-in-fiber-67f1014d0eb7)ã€‚

> è¿™ç¯‡æ–‡ç« å¦‚æœæ²¡æœ‰[Dan Abramov](https://medium.com/@dan_abramov)çš„å¸®åŠ©çš„è¯ä¸€å®šä¼šèŠ±è´¹æ›´å¤šçš„æ—¶é—´ï¼Œè€Œä¸”æ²¡æœ‰å¦‚æ­¤å…¨é¢ã€‚

è¿™æ˜¯ä¸€ç³»åˆ—æ•™ä½ ç†è§£Reactå†…éƒ¨åŸç†çš„æ–‡ç« çš„ç¬¬ä¸€ç¯‡ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³æä¾›ä¸ç®—æ³•ç›¸å…³çš„é‡è¦æ¦‚å¿µå’Œæ•°æ®ç»“æ„çš„æ·±å…¥æ¦‚è¿°ï¼Œä¸€æ—¦æˆ‘ä»¬äº†è§£äº†è¶³å¤Ÿçš„èƒŒæ™¯çŸ¥è¯†ï¼Œæˆ‘ä»¬å°†ä¼šæ¢ç´¢ç”¨äºé€’å½’å’Œè§£æfiberæ ‘çš„ç®—æ³•å’Œä¸»è¦å‡½æ•°ã€‚æ­¤ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« å°†æ¼”ç¤ºReactå¦‚ä½•ä½¿ç”¨è¯¥ç®—æ³•æ‰§è¡Œåˆå§‹æ¸²æŸ“å’Œå¤„ç†stateä»¥åŠpropsæ›´æ–°ã€‚ä»é‚£é‡Œæˆ‘ä»¬å°†ç»§ç»­è®¨è®ºè°ƒåº¦ç¨‹åºçš„ç»†èŠ‚ï¼Œå­è°ƒè§£è¿›ç¨‹ï¼Œä»¥åŠå»ºç«‹Effect listçš„æœºåˆ¶ã€‚

## ç»§ç»­ ##

æˆ‘å°†å¸¦ä½ ä¸€èµ·äº†è§£ä¸€äº›Reactçš„é«˜çº§çŸ¥è¯†ğŸ§™â€ã€‚æˆ‘é¼“åŠ±ä½ é˜…è¯»å®ƒä»¥äº†è§£Concurrent Reactå†…éƒ¨å·¥ä½œèƒŒåçš„é­”åŠ›ã€‚è€Œä¸”è¿™ä¸€ç³»åˆ—çš„æ–‡ç« ä¹Ÿèƒ½ä½œä¸ºæƒ³Reactå¼€æºé¡¹ç›®è´¡çŒ®çš„æŒ‡å—ã€‚æˆ‘éå¸¸ç›¸ä¿¡é€†å‘å·¥ç¨‹ï¼Œå› æ­¤æœ€æ–°ç‰ˆæœ¬16.6.0ä¸­çš„æºä»£ç ä¼šæœ‰å¾ˆå¤šé“¾æ¥ã€‚

è¿™é‡ŒåŒ…å«å¾ˆå¤šå†…å®¹ï¼Œæ‰€æœ‰å¦‚æœä½ ä¸èƒ½é©¬ä¸Šç†è§£çš„è¯ä¸è¦æ„Ÿåˆ°æœ‰å‹åŠ›ã€‚è¿™äº›å†…å®¹å€¼å¾—ä½ èŠ±æ—¶é—´å»äº†è§£ã€‚æ³¨æ„å¦‚æœåªæ˜¯ä¸ºäº†èƒ½ç†Ÿç»ƒä½¿ç”¨Reactï¼Œé‚£ä¹ˆä½ æ²¡å¿…è¦äº†è§£è¿™äº›å†…å®¹ã€‚è¿™ç¯‡æ–‡ç« æ˜¯ä¸ºäº†

## è®¾ç½®èƒŒæ™¯ ##

è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„ä¾‹å­æˆ‘å°†è´¯ç©¿è¿™ä¸€ç³»åˆ—æ–‡ç« ã€‚å±å¹•ä¸Šä¸ºä¸€ä¸ªé€’å¢çš„æŒ‰é’®ã€‚

![picture](http://ww4.sinaimg.cn/large/006tNc79gy1g5p8b2lejng305u01wq3m.gif)

å…·ä½“ä»£ç å¦‚ä¸‹

```javascript
class ClickCounter extends React.Component {
    constructor(props) {
        super(props);
        this.state = {count: 0};
        this.handleClick = this.handleClick.bind(this);
    }

    handleClick() {
        this.setState((state) => {
            return {count: state.count + 1};
        });
    }


    render() {
        return [
            <button key="1" onClick={this.handleClick}>Update counter</button>,
            <span key="2">{this.state.count}</span>
        ]
    }
}
```

ä½ å¯ä»¥åœ¨[æ­¤å¤„](https://stackblitz.com/edit/react-t4rdmh)è¿›è¡Œåœ¨çº¿æŸ¥çœ‹ï¼Œæ­£å¦‚ä½ æ‰€è§ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç®€å•åŒ…å«`span`å’Œ`button`å…ƒç´ çš„ç»„ä»¶ã€‚å•å‡»è¯¥æŒ‰é’®åï¼Œç»„ä»¶çš„çŠ¶æ€å°†åœ¨å¤„ç†ç¨‹åºå†…æ›´æ–°ã€‚åè¿‡æ¥ï¼Œè¿™ä¼šå¯¼è‡´spanå…ƒç´ çš„æ–‡æœ¬æ›´æ–°ã€‚

[åŸæ–‡é“¾æ¥](https://blog.ag-grid.com/inside-fiber-an-in-depth-overview-of-the-new-reconciliation-algorithm-in-react/)
